---
title: "Nmap"
tags:
- port-scanning
- scan-types
- commo-flags
categories:
- tools
toc: true
toc_sticky: true
og_image: /assets/images/nmap/logo.jpeg
---
![Domain](/assets/images/nmap/logo.jpeg)

## Introduction
Nmap is a network exploration tool that can be used to scan the ports(TCP/UDP) that the hosts are listening on. It can used to scan a single host single port to multiple hosts multiple ports. It can also be used to determine the services hosted on certain ports by the server. The manual page of nmap(`man nmap`) is pretty detailed and gives a good overview.
However, I will be listing the most common flags that I use frequently and their use. 

## Syntax
From man page of nmap, the most commonly used flags are:
```
Nmap 7.93 ( https://nmap.org )

Usage: nmap [Scan Type(s)] [Options] {target specification}

TARGET SPECIFICATION:
  Can pass hostnames, IP addresses, networks, etc.
  Ex: scanme.nmap.org, microsoft.com/24, 192.168.0.1; 10.0.0-255.1-254
  -iL <inputfilename>: Input from list of hosts/networks
  -iR <num hosts>: Choose random targets
  --exclude <host1[,host2][,host3],...>: Exclude hosts/networks
  --excludefile <exclude_file>: Exclude list from file

HOST DISCOVERY:
  -sL: List Scan - simply list targets to scan
  -sn: Ping Scan - disable port scan
  -Pn: Treat all hosts as online -- skip host discovery

SCAN TECHNIQUES:
  -sS/sT: TCP SYN/Connect() scans
  -sU: UDP Scan

PORT SPECIFICATION AND SCAN ORDER:
  -p <port ranges>: Only scan specified ports
    Ex: -p22; -p1-65535; -p U:53,111,137,T:21-25,80,139,8080,S:9
  --exclude-ports <port ranges>: Exclude the specified ports from scanning
  -F: Fast mode - Scan fewer ports than the default scan
  -r: Scan ports sequentially - don't randomize
  --top-ports <number>: Scan <number> most common ports

SERVICE/VERSION DETECTION:
  -sV: Probe open ports to determine service/version info

SCRIPT SCAN:
  -sC: Performs a script scan using the default set of scripts. It is equivalent to --script=default.  
```
## Host Discovery
Before scanning ports, nmap checks if the host is online by sending ping request. `-Pn` flag can be used to ignore ICMP being used to determine if the host is up(all hosts are treated as online).

## Default port scan
Out of 65536 possibilities for open ports, most of them are never open/used. Since, the scan time of nmap is directly proportional to the number of ports scanned, it only **scans 1000 most used ports(standard ports) by default**. Due to this, there is a chance that nmap **might miss an open port that is not common**. In such cases, we can specify the port or port range for scanning.

`nmap -p-` : performs a full scan i.e. it will scan all 65536 ports.

## Types of TCP scan:

`nmap -A -Pn 10.10.178.147`

1. SYN scan: `-sS`
    
    During 3-way handshaking, client sends SYNC request. Upon receiving SYNC-ACK from server, client doesn't acknowledge, server closes the connection by sending RST signal. Less no. of signals exchanged, comparatively less detectable. 
    
2. Connect scan: `-sT`
    
    nmap scan is treated as other normal requests. All three handshaking signals are exchanged. Easily detected/logged.
    

## Nmap Timing:

- 6 different timing available from `-T0` to `-T5`
- `-T0` is slowest, it waits for few minutes for server's response. More reliable.
- `-T5` quickest scan, it waits for few milliseconds for server's response. Less reliable.
- By default, if no timing specified, `-T3` is used.

## Output(Example)

1. `-sV`: 

    ![](/assets/images/nmap/script_sV.png)

2. `-sC`: flag gives information regarding the certificates, validation dates for each port, etc.
    ![](/assets/images/nmap/script_sC.png)
3. `-A`: 
- Scan the host to identify services running by matching against Nmap's database with OS detection
- very handy, equivalent to adding `-sV` `-sC` `-O` flag

    ```
    $ nmap -A 10.10.11.100 | tee nmap_scan                  
    Starting Nmap 7.91 ( https://nmap.org ) at 2021-08-05 00:47 EDT
    Nmap scan report for 10.10.11.100
    Host is up (0.17s latency).
    Not shown: 998 closed ports
    PORT   STATE SERVICE VERSION
    22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
    | ssh-hostkey: 
    |   3072 d4:4c:f5:79:9a:79:a3:b0:f1:66:25:52:c9:53:1f:e1 (RSA)
    |   256 a2:1e:67:61:8d:2f:7a:37:a7:ba:3b:51:08:e8:89:a6 (ECDSA)
    |_  256 a5:75:16:d9:69:58:50:4a:14:11:7a:42:c1:b6:23:44 (ED25519)
    80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))
    |_http-server-header: Apache/2.4.41 (Ubuntu)
    |_http-title: Bounty Hunters
    Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

    Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
    Nmap done: 1 IP address (1 host up) scanned in 26.94 seconds
    ```

## Defending nmap scan

- Open-source Intrusion Detection System(IDS) and Intrusion Prevention System(IPS) such as Snort and Suricata can be used to detect and block nmap scan.
- When multiple request packets to different ports of the server, from the same machine are detected, they block the IP address of the machine.
- Connect scan requests with `-T5` are more likely to be detected.